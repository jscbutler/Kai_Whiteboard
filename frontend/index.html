<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Kai Family Whiteboard</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Kiosk mode styles */
        body {
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }
        
        /* Kai Sleep Mode Animations */
        @keyframes breathe {
            0%, 100% { transform: scale(1) translateY(0); }
            50% { transform: scale(1.02) translateY(-5px); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(59, 130, 246, 0.8)); }
        }
        
        @keyframes blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }
        
        .kai-sleep-avatar {
            animation: breathe 4s ease-in-out infinite, glow 3s ease-in-out infinite;
        }
        
        .kai-antennae {
            animation: wiggle 3s ease-in-out infinite;
            transform-origin: bottom center;
        }
        
        .kai-eyes {
            animation: blink 4s ease-in-out infinite;
        }
        
        /* Sleep mode ambient effects */
        .ambient-bubble {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent);
            animation: float 6s ease-in-out infinite;
            pointer-events: none;
        }
        
        /* Regular Kai panel animations */
        .kai-avatar {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Seasonal themes */
        .theme-easter {
            --primary: #FFB7C5;
            --secondary: #98FB98;
            --accent: #FFD700;
        }
        
        .theme-halloween {
            --primary: #FF6B35;
            --secondary: #1a1a2e;
            --accent: #9d4edd;
        }
        
        .theme-christmas {
            --primary: #c41e3a;
            --secondary: #165b33;
            --accent: #FFD700;
        }
        
        .theme-default {
            --primary: #3b82f6;
            --secondary: #1e40af;
            --accent: #f59e0b;
        }
        
        /* Sleep screen fade */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        /* Scrollbar for task list */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white h-screen w-screen overflow-hidden theme-default">
    <div id="app" class="h-full w-full relative">
        
        <!-- SLEEP MODE - Kai Front and Center -->
        <transition name="fade">
            <div v-if="sleepMode" 
                 @click="wakeUp"
                 class="absolute inset-0 z-50 bg-gradient-to-br from-blue-900 via-purple-900 to-blue-900 flex">
                
                <!-- Ambient bubbles -->
                <div class="ambient-bubble w-32 h-32 top-10 left-10 opacity-30"></div>
                <div class="ambient-bubble w-24 h-24 top-40 right-20 opacity-20" style="animation-delay: 1s;"></div>
                <div class="ambient-bubble w-40 h-40 bottom-20 left-1/4 opacity-25" style="animation-delay: 2s;"></div>
                <div class="ambient-bubble w-20 h-20 top-1/3 left-1/3 opacity-15" style="animation-delay: 3s;"></div>
                
                <!-- Main Kai Area -->
                <div class="flex-1 flex flex-col items-center justify-center relative">
                    <!-- Greeting -->
                    <div class="absolute top-8 text-center">
                        <h1 class="text-4xl font-light opacity-80 mb-2">{{ sleepGreeting }}</h1>
                        <p class="text-xl opacity-60">{{ currentTime }}</p>
                    </div>
                    
                    <!-- Giant Kai -->
                    <div class="kai-sleep-avatar relative cursor-pointer transform hover:scale-105 transition-transform">
                        <!-- Outer glow ring -->
                        <div class="absolute inset-0 bg-blue-500 rounded-full blur-3xl opacity-30 animate-pulse"></div>
                        
                        <!-- Kai SVG -->
                        <svg width="350" height="350" viewBox="0 0 200 200" class="relative z-10">
                            <!-- Body -->
                            <ellipse cx="100" cy="120" rx="60" ry="50" fill="#3b82f6" />
                            <ellipse cx="100" cy="120" rx="50" ry="40" fill="#60a5fa" />
                            
                            <!-- Eyes -->
                            <g class="kai-eyes">
                                <ellipse cx="80" cy="100" rx="12" ry="15" fill="white" />
                                <ellipse cx="80" cy="100" rx="6" ry="8" fill="black" />
                                <ellipse cx="120" cy="100" rx="12" ry="15" fill="white" />
                                <ellipse cx="120" cy="100" rx="6" ry="8" fill="black" />
                            </g>
                            
                            <!-- Smile -->
                            <path d="M 85 135 Q 100 145 115 135" stroke="white" stroke-width="3" fill="none" stroke-linecap="round" />
                            
                            <!-- Antennae -->
                            <g class="kai-antennae">
                                <path d="M 70 75 Q 60 40 50 30" stroke="#3b82f6" stroke-width="4" fill="none" stroke-linecap="round" />
                                <circle cx="50" cy="30" r="6" fill="#f59e0b" />
                                <path d="M 130 75 Q 140 40 150 30" stroke="#3b82f6" stroke-width="4" fill="none" stroke-linecap="round" />
                                <circle cx="150" cy="30" r="6" fill="#f59e0b" />
                            </g>
                            
                            <!-- Claws -->
                            <ellipse cx="45" cy="130" rx="15" ry="20" fill="#1e40af" />
                            <ellipse cx="155" cy="130" rx="15" ry="20" fill="#1e40af" />
                            
                            <!-- Legs -->
                            <ellipse cx="65" cy="165" rx="8" ry="15" fill="#2563eb" />
                            <ellipse cx="85" cy="168" rx="8" ry="15" fill="#2563eb" />
                            <ellipse cx="115" cy="168" rx="8" ry="15" fill="#2563eb" />
                            <ellipse cx="135" cy="165" rx="8" ry="15" fill="#2563eb" />
                        </svg>
                        
                        <!-- Tap to wake hint -->
                        <div class="absolute -bottom-16 left-1/2 transform -translate-x-1/2 text-center">
                            <p class="text-lg opacity-60 animate-pulse">Tap anywhere to wake up</p>
                        </div>
                    </div>
                    
                    <!-- Sleep message -->
                    <div class="absolute bottom-32 text-center max-w-md">
                        <p class="text-2xl opacity-90 italic">"{{ sleepMessage }}"</p>
                    </div>
                </div>
                
                <!-- Today's Tasks Sidebar -->
                <div class="w-96 bg-black bg-opacity-40 backdrop-blur-sm p-6 flex flex-col">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        üìã Today's Tasks
                    </h2>
                    
                    <div class="flex-1 overflow-y-auto custom-scrollbar space-y-4">
                        <!-- Next Up -->
                        <div v-if="nextEvent" class="bg-blue-600 bg-opacity-30 rounded-lg p-4 border-l-4 border-blue-400">
                            <p class="text-sm opacity-70 mb-1">Up Next</p>
                            <p class="text-lg font-semibold">{{ nextEvent.title }}</p>
                            <p class="text-sm opacity-80">{{ nextEvent.start }}</p>
                        </div>
                        
                        <!-- Today's Events -->
                        <div v-if="todayEvents.length === 0" class="text-center opacity-50 py-8">
                            <p class="text-4xl mb-2">üå¥</p>
                            <p>No events today!</p>
                            <p class="text-sm">Time to relax!</p>
                        </div>
                        
                        <div v-for="(event, index) in todayEvents" :key="event.id"
                             class="bg-white bg-opacity-10 rounded-lg p-3 flex items-center gap-3"
                             :class="{ 'opacity-50': event.isPast }">
                            <div class="w-2 h-12 rounded-full" :style="{ backgroundColor: event.color }"></div>
                            <div class="flex-1">
                                <p class="font-medium">{{ event.title }}</p>
                                <p class="text-sm opacity-70">{{ event.start }}</p>
                            </div>
                            <div v-if="event.isPast" class="text-xs bg-gray-600 px-2 py-1 rounded">Done</div>
                        </div>
                    </div>
                    
                    <!-- Quick stats -->
                    <div class="mt-6 pt-4 border-t border-white border-opacity-20">
                        <div class="flex justify-between text-sm opacity-70">
                            <span>Events today: {{ todayEvents.length }}</span>
                            <span>Completed: {{ completedEvents }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </transition>
        
        <!-- MAIN APP - Calendar View -->
        <div v-if="!sleepMode" class="h-full w-full flex flex-col">
            <!-- Header -->
            <header class="flex justify-between items-center p-4 bg-opacity-20 bg-black">
                <div class="flex items-center gap-4">
                    <div class="text-2xl font-bold">
                        {{ currentDate }}
                    </div>
                    <div class="text-xl opacity-80">
                        {{ currentTime }}
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-sm opacity-60">Weather:</span>
                    <span>‚òÄÔ∏è 12¬∞C</span>
                    <button @click="enterSleepMode" class="ml-4 px-3 py-1 bg-white bg-opacity-10 rounded-lg hover:bg-opacity-20 transition text-sm">
                        üí§ Sleep
                    </button>
                </div>
            </header>
            
            <!-- Main Content -->
            <main class="flex-1 flex overflow-hidden">
                <!-- Calendar View -->
                <div class="flex-1 p-4 overflow-y-auto">
                    <div class="grid grid-cols-7 gap-2 h-full">
                        <!-- Day headers -->
                        <div v-for="day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']" 
                             :key="day"
                             class="text-center font-bold text-lg opacity-80">
                            {{ day }}
                        </div>
                        
                        <!-- Day cells -->
                        <div v-for="(day, index) in weekDays" 
                             :key="index"
                             class="border border-white border-opacity-20 rounded-lg p-2 min-h-[120px]"
                             :class="{ 'bg-white bg-opacity-10': day.isToday }">
                            <div class="text-sm opacity-60">{{ day.date }}</div>
                            <!-- Events -->
                            <div v-for="event in day.events" 
                                 :key="event.id"
                                 class="mt-1 p-1 rounded text-xs truncate"
                                 :style="{ backgroundColor: event.color }">
                                {{ event.title }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Kai Panel -->
                <div class="w-80 p-4 flex flex-col items-center justify-center border-l border-white border-opacity-20">
                    <!-- Kai Avatar -->
                    <div class="kai-avatar relative cursor-pointer" @click="interactWithKai">
                        <svg width="200" height="200" viewBox="0 0 200 200">
                            <ellipse cx="100" cy="120" rx="60" ry="50" fill="#3b82f6" />
                            <ellipse cx="100" cy="120" rx="50" ry="40" fill="#60a5fa" />
                            <ellipse cx="80" cy="100" rx="12" ry="15" fill="white" />
                            <ellipse cx="80" cy="100" rx="6" ry="8" fill="black" />
                            <ellipse cx="120" cy="100" rx="12" ry="15" fill="white" />
                            <ellipse cx="120" cy="100" rx="6" ry="8" fill="black" />
                            <path d="M 85 135 Q 100 145 115 135" stroke="white" stroke-width="3" fill="none" stroke-linecap="round" />
                            <path d="M 70 75 Q 60 40 50 30" stroke="#3b82f6" stroke-width="4" fill="none" stroke-linecap="round" />
                            <circle cx="50" cy="30" r="6" fill="#f59e0b" />
                            <path d="M 130 75 Q 140 40 150 30" stroke="#3b82f6" stroke-width="4" fill="none" stroke-linecap="round" />
                            <circle cx="150" cy="30" r="6" fill="#f59e0b" />
                        </svg>
                        <div class="absolute bottom-2 right-2 w-4 h-4 bg-green-500 rounded-full animate-pulse"></div>
                    </div>
                    
                    <!-- Kai Message -->
                    <div class="mt-4 p-4 bg-white bg-opacity-10 rounded-lg max-w-xs text-center">
                        <p class="text-lg">{{ kaiMessage }}</p>
                    </div>
                    
                    <!-- Voice indicator -->
                    <div v-if="isListening" class="mt-4 flex items-center gap-2">
                        <div class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>
                        <span class="text-sm">Listening...</span>
                    </div>
                    
                    <!-- Quick actions -->
                    <div class="mt-8 flex flex-wrap gap-2 justify-center">
                        <button @click="addEvent" class="px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition">
                            + Event
                        </button>
                        <button @click="askKai" class="px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700 transition">
                            Ask Kai
                        </button>
                        <button @click="getWordOfDay" class="px-4 py-2 bg-purple-600 rounded-lg hover:bg-purple-700 transition">
                            üåç Word
                        </button>
                        <button @click="interactWithKai" class="px-4 py-2 bg-orange-500 rounded-lg hover:bg-orange-600 transition">
                            ü¶û Surprise!
                        </button>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <script>
        const { createApp, ref, onMounted, computed } = Vue;
        
        createApp({
            setup() {
                const currentDate = ref('');
                const currentTime = ref('');
                const kaiMessage = ref('Hello! I\'m Kai. Tap me for a surprise!');
                const isListening = ref(false);
                const weekDays = ref([]);
                const sleepMode = ref(false);
                const sleepMessage = ref('Dreaming of tomorrow\'s adventures...');
                const API_URL = 'http://localhost:8000';
                let idleTimer = null;
                
                const sleepGreeting = computed(() => {
                    const hour = new Date().getHours();
                    if (hour < 12) return 'Good morning!';
                    if (hour < 18) return 'Good afternoon!';
                    return 'Good evening!';
                });
                
                const todayEvents = computed(() => {
                    const today = weekDays.value.find(d => d.isToday);
                    if (!today) return [];
                    const now = new Date();
                    return today.events.map(e => ({
                        ...e,
                        isPast: new Date(e.fullDate + 'T' + e.start) < now
                    })).sort((a, b) => a.start.localeCompare(b.start));
                });
                
                const nextEvent = computed(() => {
                    const now = new Date();
                    return todayEvents.value.find(e => !e.isPast);
                });
                
                const completedEvents = computed(() => {
                    return todayEvents.value.filter(e => e.isPast).length;
                });
                
                const updateTime = () => {
                    const now = new Date();
                    currentDate.value = now.toLocaleDateString('en-IE', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    currentTime.value = now.toLocaleTimeString('en-IE', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                };
                
                const loadCalendar = async () => {
                    try {
                        const response = await fetch(`${API_URL}/api/calendar/week`);
                        const data = await response.json();
                        weekDays.value = data.days.map(day => ({
                            date: day.day_num,
                            fullDate: day.date,
                            dayName: day.day_name,
                            isToday: day.is_today,
                            events: day.events.map(e => ({
                                id: e.id,
                                title: e.title,
                                color: e.color,
                                start: new Date(e.start).toLocaleTimeString('en-IE', {hour: '2-digit', minute:'2-digit'})
                            }))
                        }));
                    } catch (e) {
                        console.error('Failed to load calendar:', e);
                    }
                };
                
                const interactWithKai = async () => {
                    kaiMessage.value = "Thinking... ü§î";
                    resetIdleTimer();
                    try {
                        const response = await fetch(`${API_URL}/api/kai/interact`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({trigger: 'tap'})
                        });
                        const data = await response.json();
                        kaiMessage.value = data.message || "Hello! I'm Kai!";
                    } catch (e) {
                        const responses = [
                            "Did you know? Lobsters can live to be 100 years old! ü¶û",
                            "¬°Ol√©! Kelligh, you are fantastico! üíÉ",
                            "Sawasdee! That's Hello in Thai! üáπüá≠",
                            "Mammy is the best! Give her a hug! ü§ó",
                            "Kelligh, you're doing amazing today! ‚≠ê",
                            "Today's going to be a great day! ‚òÄÔ∏è",
                            "Bart is such a good doggo! üêï",
                            "I'm learning new things every night! üìö"
                        ];
                        kaiMessage.value = responses[Math.floor(Math.random() * responses.length)];
                    }
                };
                
                const addEvent = () => {
                    kaiMessage.value = "Say: 'Hey Kai, add event for...'";
                    isListening.value = true;
                    resetIdleTimer();
                    setTimeout(() => { isListening.value = false; }, 3000);
                };
                
                const askKai = () => {
                    isListening.value = true;
                    kaiMessage.value = "Listening... üëÇ";
                    resetIdleTimer();
                    setTimeout(() => {
                        isListening.value = false;
                        kaiMessage.value = "I heard you! What would you like to know?";
                    }, 3000);
                };
                
                const getWordOfDay = async () => {
                    resetIdleTimer();
                    try {
                        const response = await fetch(`${API_URL}/api/kai/interact`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({trigger: 'word'})
                        });
                        const data = await response.json();
                        if (data.type === 'word_of_the_day') {
                            kaiMessage.value = `${data.language} Word: "${data.word}" means "${data.english}" (${data.pronunciation})`;
                        }
                    } catch (e) {
                        kaiMessage.value = "Word of the day: 'Agua' (Spanish) = Water üíß";
                    }
                };
                
                const enterSleepMode = () => {
                    sleepMode.value = true;
                    const sleepMessages = [
                        "Dreaming of tomorrow's adventures...",
                        "Resting my claws for tomorrow...",
                        "Counting lobsters instead of sheep...",
                        "Thinking of new jokes for Kelligh...",
                        "Planning my next outfit...",
                        "Dreaming of Thai beaches and Spanish festivals..."
                    ];
                    sleepMessage.value = sleepMessages[Math.floor(Math.random() * sleepMessages.length)];
                };
                
                const wakeUp = () => {
                    sleepMode.value = false;
                    resetIdleTimer();
                    kaiMessage.value = "Good to see you! ‚òÄÔ∏è";
                };
                
                const resetIdleTimer = () => {
                    if (idleTimer) clearTimeout(idleTimer);
                    idleTimer = setTimeout(() => {
                        if (!sleepMode.value) enterSleepMode();
                    }, 120000); // 2 minutes idle = sleep mode
                };
                
                onMounted(() => {
                    updateTime();
                    setInterval(updateTime, 1000);
                    loadCalendar();
                    setInterval(loadCalendar, 300000);
                    resetIdleTimer();
                    
                    // Listen for activity to reset timer
                    document.addEventListener('click', resetIdleTimer);
                    document.addEventListener('touchstart', resetIdleTimer);
                });
                
                return {
                    currentDate,
                    currentTime,
                    weekDays,
                    kaiMessage,
                    isListening,
                    sleepMode,
                    sleepMessage,
                    sleepGreeting,
                    todayEvents,
                    nextEvent,
                    completedEvents,
                    interactWithKai,
                    addEvent,
                    askKai,
                    getWordOfDay,
                    enterSleepMode,
                    wakeUp
                };
            }
        }).mount('#app');
    </script>
</body>
</html>